import{c as e,u as s,e as a,h as t,j as r,$ as n,a0 as d,a1 as l,a2 as c,a4 as i,i as o,L as m,M as u,N as x,O as h,Q as g,R as j,I as p,V as y,B as f,s as b,o as N,m as v,a as w,D as C,k as B,l as k,n as M,d as S,f as T,a5 as L,r as P,Z as q,a6 as I,b as _}from"./index-BKzwkbhU.js";import{u as D,P as A}from"./use-toast-C_SwDZk4.js";import{A as E,a as O}from"./alert-CN8C4i7Y.js";import{u as F,t as z,z as R}from"./index-Ce1Og8sm.js";import{C as K,u as U}from"./chartUtils-DiUYslSS.js";import{C as V}from"./circle-alert-Cu41asrS.js";import{D as $}from"./download-85JYEFVe.js";import{P as Q}from"./plus-BP6d835L.js";import{C as Y,a as W,b as Z,c as G}from"./card-d84NS_n5.js";import{S as H}from"./skeleton-CF78e7qN.js";import{T as X,a as J,b as ee,c as se}from"./tabs-SXOt8X-a.js";import{R as ae,P as te,a as re,C as ne,T as de,B as le,b as ce,X as ie,Y as oe,c as me}from"./PieChart-Bu6X0L8j.js";import{T as ue,a as xe,b as he,c as ge,d as je,e as pe}from"./table-BAksRuoR.js";import{E as ye,P as fe}from"./pencil-1wjTYd5V.js";import{T as be}from"./trash-2-CDOPMnMG.js";import{p as Ne}from"./parseISO-C5wMadzM.js";import{e as ve}from"./endOfMonth-DamK16rX.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=e("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),Ce=e("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Be=R.object({category:R.string().min(1,"Category is required"),amount:R.number().min(0,"Amount must be positive"),period:R.enum(["monthly","quarterly","yearly"]),carry_forward:R.boolean()});
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function ke({open:e,onOpenChange:N,budget:v,onSuccess:w,monthlyIncome:C,totalBudget:B}){const{user:k}=s(),M=a(),{currencyCode:S}=t(),{register:T,handleSubmit:L,reset:P,setValue:q,watch:I,formState:{errors:_}}=F({resolver:z(Be),defaultValues:v||{category:"",amount:0,period:"monthly",carry_forward:!1}}),D=I("amount"),A=v?B-((null==v?void 0:v.amount)||0)+D>C&&C>0:B+D>C&&C>0,R=v?B-((null==v?void 0:v.amount)||0)+D-C:B+D-C;return r.jsx(n,{open:e,onOpenChange:N,children:r.jsxs(d,{side:M?"bottom":"right",className:M?"h-[90%] rounded-t-2xl":"",children:[r.jsxs(l,{children:[r.jsxs(c,{children:[v?"Edit":"Create"," Budget"]}),r.jsx(i,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none"})]}),r.jsxs("form",{onSubmit:L((async e=>{if(k&&!A)try{const s={amount:e.amount,category:e.category,period:e.period,carry_forward:e.carry_forward,user_id:k.id};if(v){const{error:e}=await b.from("budgets").update(s).eq("id",v.id);if(e)throw e}else{const{error:e}=await b.from("budgets").insert(s);if(e)throw e}P(),w()}catch(s){}})),className:"space-y-5 pt-6 budget-form-container",children:[A&&r.jsxs(E,{variant:"destructive",children:[r.jsx(V,{className:"h-4 w-4"}),r.jsxs(O,{children:["Warning: Your total budget will exceed your monthly income by ",o(R,S)]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(m,{htmlFor:"category",children:"Category"}),r.jsxs(u,{value:I("category"),onValueChange:e=>q("category",e),children:[r.jsx(x,{className:"w-full",children:r.jsx(h,{placeholder:"Select category"})}),r.jsx(g,{children:Object.keys(K).map((e=>r.jsx(j,{value:e,children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:K[e]}}),e]})},e)))})]}),_.category&&r.jsx("p",{className:"text-xs text-red-500 mt-1",children:_.category.message})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(m,{htmlFor:"amount",children:"Budget Amount"}),r.jsx(p,{id:"amount",type:"number",min:"0",step:"0.01",placeholder:"0.00",...T("amount",{valueAsNumber:!0}),className:"text-base"}),_.amount&&r.jsx("p",{className:"text-xs text-red-500 mt-1",children:_.amount.message})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(m,{htmlFor:"period",children:"Budget Period"}),r.jsxs(u,{value:I("period"),onValueChange:e=>q("period",e),children:[r.jsx(x,{className:"w-full",children:r.jsx(h,{placeholder:"Select period"})}),r.jsxs(g,{children:[r.jsx(j,{value:"monthly",children:"Monthly"}),r.jsx(j,{value:"quarterly",children:"Quarterly (3 months)"}),r.jsx(j,{value:"yearly",children:"Yearly"})]})]}),_.period&&r.jsx("p",{className:"text-xs text-red-500 mt-1",children:_.period.message})]}),r.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/20 rounded-lg",children:[r.jsx(m,{htmlFor:"carry_forward",className:"flex-1 cursor-pointer",children:"Carry Forward Unused Amount"}),r.jsx(y,{id:"carry_forward",checked:I("carry_forward"),onCheckedChange:e=>q("carry_forward",e)})]}),r.jsxs("div",{className:"flex justify-end gap-2 mt-6 pt-4 border-t",children:[r.jsx(i,{asChild:!0,children:r.jsx(f,{variant:"outline",type:"button",children:"Cancel"})}),r.jsxs(f,{type:"submit",disabled:A,children:[v?"Update":"Create"," Budget"]})]})]})]})})}const Me=({onAddBudget:e,onExport:s})=>{const t=a();return r.jsxs("header",{className:N("space-y-3 mb-4",t?"px-1":"flex justify-between items-center space-y-0"),children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("h1",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-primary to-primary/80 bg-clip-text text-transparent",children:"Budget"}),r.jsx("p",{className:"text-muted-foreground text-xs md:text-sm",children:"Manage and track your budget allocations"})]}),t?r.jsxs("div",{className:"flex justify-between items-center gap-2",children:[r.jsxs(f,{variant:"outline",onClick:s,size:"sm",className:"flex-1 text-xs h-auto rounded-lg my-0 py-[9px] px-0 mx-[9px]",children:[r.jsx($,{className:"h-3 w-3 mr-1"}),"Export"]}),r.jsxs(f,{size:"sm",onClick:e,className:"flex-1 rounded-lg text-xs h-auto py-[9px] mx-[10px] px-0 text-center",children:[r.jsx(Q,{className:"h-3 w-3 mr-1"}),"Add Budget"]})]}):r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(f,{variant:"outline",onClick:s,className:"rounded-lg",children:[r.jsx($,{className:"h-4 w-4 mr-2"}),"Export"]}),r.jsxs(f,{onClick:e,className:"rounded-lg",children:[r.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add Budget"]})]})]})},Se=({totalBudget:e,remainingBalance:s,usagePercentage:n,monthlyIncome:d,isLoading:l=!1})=>{a();const{currencyCode:c}=t(),i=e>d&&d>0;return l?r.jsxs("div",{className:"space-y-3",children:[r.jsx(H,{className:"h-12 w-full"}),r.jsx("div",{className:"grid gap-3 grid-cols-2",children:[1,2,3,4].map((e=>r.jsx(H,{className:"h-[100px]"},e)))})]}):r.jsxs("div",{className:"space-y-3",children:[i&&r.jsxs(E,{variant:"destructive",className:"rounded-lg mx-0",children:[r.jsx(V,{className:"h-4 w-4"}),r.jsxs(O,{children:["Warning: Your total budget exceeds your monthly income by ",o(e-d,c)]})]}),r.jsxs("div",{className:"grid gap-3 grid-cols-2 my-0 py-[7px]",children:[r.jsxs(Y,{className:"shadow-md border-border/50 glass-card",children:[r.jsx(W,{className:"p-3 pb-0",children:r.jsx(Z,{className:"text-sm font-medium text-muted-foreground",children:"Total Budget"})}),r.jsx(G,{className:"p-3",children:r.jsx("div",{className:"text-xl font-bold",children:o(e,c)})})]}),r.jsxs(Y,{className:"shadow-md border-border/50 glass-card",children:[r.jsx(W,{className:"p-3 pb-0",children:r.jsx(Z,{className:"text-sm font-medium text-muted-foreground",children:"Remaining"})}),r.jsx(G,{className:"p-3",children:r.jsx("div",{className:"text-xl font-bold",children:o(s,c)})})]}),r.jsxs(Y,{className:"shadow-md border-border/50 glass-card",children:[r.jsx(W,{className:"p-3 pb-0",children:r.jsx(Z,{className:"text-sm font-medium text-muted-foreground",children:"Usage"})}),r.jsx(G,{className:"p-3",children:r.jsxs("div",{className:"text-xl font-bold",children:[n.toFixed(1),"%"]})})]}),r.jsxs(Y,{className:"shadow-md border-border/50 glass-card",children:[r.jsx(W,{className:"p-3 pb-0",children:r.jsx(Z,{className:"text-sm font-medium text-muted-foreground",children:"Income"})}),r.jsx(G,{className:"p-3",children:r.jsx("div",{className:"text-xl font-bold",children:o(d,c)})})]})]})]})};function Te({budgets:e}){const s=a(),{currencyCode:n}=t(),d=e.filter((e=>"CurrencyPreference"!==e.category)),l=d.reduce(((e,s)=>e+s.amount),0),c=d.map((e=>({name:e.category,value:e.amount,percentage:l>0?(e.amount/l*100).toFixed(0):"0"})));return 0===d.length?r.jsxs(Y,{className:"bg-card/95 backdrop-blur-sm border-border/40",children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Overview"})}),r.jsx(G,{children:r.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-8 px-4 text-center space-y-3",children:[r.jsx("p",{className:"text-muted-foreground",children:"No budget categories found"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Add your first budget to see an overview here"})]})})]}):r.jsxs(Y,{className:"bg-card/95 backdrop-blur-sm border-border/40",children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Overview"})}),r.jsx(G,{children:r.jsx(v.div,{className:"h-full space-y-6",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:r.jsxs("div",{className:"rounded-xl bg-background/50 p-6",children:[r.jsxs("div",{className:"w-full h-[300px] relative pie-chart-container",children:[r.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center z-10",children:[r.jsx("p",{className:"text-2xl font-semibold",children:o(l,n)}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Budget"})]}),r.jsx(ae,{width:"100%",height:"100%",children:r.jsxs(te,{children:[r.jsx(re,{data:c,cx:"50%",cy:"50%",innerRadius:s?60:80,outerRadius:s?85:110,paddingAngle:3,dataKey:"value",cornerRadius:6,strokeWidth:2,stroke:"white",children:c.map(((e,s)=>r.jsx(ne,{fill:K[e.name]},`cell-${s}`)))}),r.jsx(de,{content:({active:e,payload:s})=>{if(!e||!(null==s?void 0:s.length))return null;const a=s[0].payload;return r.jsxs(v.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"rounded-lg border bg-card/95 backdrop-blur-sm p-3 shadow-sm",children:[r.jsx("p",{className:"text-sm font-medium",children:a.name}),r.jsx("p",{className:"text-sm",children:o(a.value,n)}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.percentage,"% of total"]})]})}})]})})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mt-6",children:c.map(((e,s)=>r.jsxs(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*s},className:"flex items-center gap-2 p-2 rounded-lg bg-card/50",children:[r.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:K[e.name]}}),r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsx("p",{className:"text-xs font-medium truncate",children:e.name}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.percentage,"%"]})]})]},s)))})]})})})]})}function Le({budgets:e,onEditBudget:s}){const{toast:n}=D(),d=w(),l=a(),{currencyCode:c}=t(),i=async e=>{try{const{error:s}=await b.from("budgets").delete().eq("id",e);if(s)throw s;await d.invalidateQueries({queryKey:["budgets"]}),n({title:"Budget deleted",description:"The budget has been successfully deleted."})}catch(s){n({title:"Error",description:"Failed to delete the budget. Please try again.",variant:"destructive"})}},{data:m=[],error:u}=U({queryKey:["expenses"],queryFn:async()=>{const e=S(new Date),{data:s,error:a}=await b.from("expenses").select("*").gte("date",e.toISOString().split("T")[0]);if(a)throw a;return s||[]}}),x=e=>{if(!m)return 0;return m.filter((s=>s.category.toLowerCase()===e.toLowerCase())).reduce(((e,s)=>e+Number(s.amount)),0)},h=e.filter((e=>"CurrencyPreference"!==e.category));return 0===h.length?r.jsxs(Y,{children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Categories"})}),r.jsx(G,{children:r.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-4 text-center",children:[r.jsx("p",{className:"text-muted-foreground mb-2",children:"No budget categories found"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Add your first budget to start tracking your spending by category"})]})})]}):r.jsxs(Y,{children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Categories"})}),r.jsx(G,{className:"pt-4",children:r.jsx("div",{className:"space-y-4",children:l?r.jsx("div",{className:"space-y-4",children:h.map((e=>{const a=x(e.category),t=Number(e.amount)-a,n=Number(e.amount)>0?Math.min(a/Number(e.amount)*100,100):0,d=a>Number(e.amount);return r.jsx(Y,{className:"bg-card/50 border-border/50 overflow-hidden "+(d?"border-l-4 border-l-red-500":""),children:r.jsxs(G,{className:"p-4 space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium",children:e.category}),r.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:e.period})]}),r.jsxs(C,{children:[r.jsx(B,{asChild:!0,children:r.jsx(f,{variant:"ghost",className:"h-8 w-8 p-0",children:r.jsx(ye,{className:"h-4 w-4"})})}),r.jsxs(k,{align:"end",children:[r.jsxs(M,{onClick:()=>s(e),children:[r.jsx(fe,{className:"mr-2 h-4 w-4"}),"Edit"]}),r.jsxs(M,{onClick:()=>i(e.id),className:"text-red-600",children:[r.jsx(be,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{className:"bg-background/50 p-2 rounded-md",children:[r.jsx("p",{className:"text-muted-foreground text-xs",children:"Budgeted"}),r.jsx("p",{className:"font-medium",children:o(Number(e.amount),c)})]}),r.jsxs("div",{className:"bg-background/50 p-2 rounded-md",children:[r.jsx("p",{className:"text-muted-foreground text-xs",children:"Spent"}),r.jsx("p",{className:"font-medium "+(d?"text-red-500":""),children:o(a,c)})]}),r.jsxs("div",{className:"bg-background/50 p-2 rounded-md",children:[r.jsx("p",{className:"text-muted-foreground text-xs",children:"Remaining"}),r.jsx("p",{className:"font-medium "+(t<0?"text-red-500":""),children:o(t,c)})]}),r.jsxs("div",{className:"bg-background/50 p-2 rounded-md",children:[r.jsx("p",{className:"text-muted-foreground text-xs",children:"Progress"}),r.jsxs("p",{className:"font-medium",children:[n.toFixed(0),"%"]})]})]}),r.jsx(A,{value:n,className:"w-full h-2 "+(d?"bg-red-200":""),indicatorClassName:d?"bg-red-500":void 0})]})},e.id)}))}):r.jsxs(ue,{children:[r.jsx(xe,{children:r.jsxs(he,{children:[r.jsx(ge,{children:"Category"}),r.jsx(ge,{children:"Period"}),r.jsx(ge,{children:"Budgeted"}),r.jsx(ge,{children:"Spent"}),r.jsx(ge,{children:"Remaining"}),r.jsx(ge,{children:"Progress"}),r.jsx(ge,{children:"Actions"})]})}),r.jsx(je,{children:h.map((e=>{const a=x(e.category),t=Number(e.amount)-a,n=Number(e.amount)>0?Math.min(a/Number(e.amount)*100,100):0,d=a>Number(e.amount);return r.jsxs(he,{className:d?"bg-red-50/10":void 0,children:[r.jsx(pe,{children:e.category}),r.jsx(pe,{className:"capitalize",children:e.period}),r.jsx(pe,{children:o(Number(e.amount),c)}),r.jsx(pe,{className:d?"text-red-500 font-medium":void 0,children:o(a,c)}),r.jsx(pe,{className:t<0?"text-red-500 font-medium":void 0,children:o(t,c)}),r.jsx(pe,{className:"w-[200px]",children:r.jsx(A,{value:n,className:d?"bg-red-200":void 0,indicatorClassName:d?"bg-red-500":void 0})}),r.jsx(pe,{children:r.jsxs(C,{children:[r.jsx(B,{asChild:!0,children:r.jsx(f,{variant:"ghost",className:"h-8 w-8 p-0",children:r.jsx(ye,{className:"h-4 w-4"})})}),r.jsxs(k,{align:"end",children:[r.jsxs(M,{onClick:()=>s(e),children:[r.jsx(fe,{className:"mr-2 h-4 w-4"}),"Edit"]}),r.jsxs(M,{onClick:()=>i(e.id),className:"text-red-600",children:[r.jsx(be,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},e.id)}))})]})})})]})}function Pe({budgets:e=[]}){const{user:n}=s(),d=a(),{currencyCode:l}=t(),{data:c=[],isLoading:i}=U({queryKey:["expenses"],queryFn:async()=>{if(!n)return[];const{data:e,error:s}=await b.from("expenses").select("*").order("date",{ascending:!1}).limit(20);return s?[]:e},enabled:!!n}),m=e.length>0&&e.some((e=>Number(e.amount)>0));if(i)return r.jsxs(Y,{children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Transactions"})}),r.jsx(G,{children:r.jsx("div",{className:"flex justify-center p-4",children:r.jsx("p",{className:"text-muted-foreground",children:"Loading transactions..."})})})]});if(!m)return r.jsxs(Y,{children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Transactions"})}),r.jsx(G,{children:r.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-4 text-center",children:[r.jsx("p",{className:"text-muted-foreground mb-2",children:"No budget categories have been set up yet."}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Create a budget first to see your transactions against your budget."})]})})]});if(0===c.length)return r.jsxs(Y,{children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Transactions"})}),r.jsx(G,{children:r.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-4 text-center",children:[r.jsx("p",{className:"text-muted-foreground mb-2",children:"No transactions found."}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Add some expenses to see them here."})]})})]});const u=s=>e.find((e=>e.category===s.category))||null;return r.jsxs(Y,{children:[r.jsx(W,{children:r.jsx(Z,{children:"Budget Transactions"})}),r.jsx(G,{children:r.jsx("div",{className:"space-y-3 w-full overflow-hidden max-w-full",children:d?r.jsx("div",{className:"space-y-2 w-full overflow-hidden",children:c.map((e=>{const s=u(e),a=s?Number(s.amount):0;return r.jsx(Y,{className:"overflow-hidden border-border/40 shadow-sm w-full",children:r.jsx(G,{className:"p-3",children:r.jsxs("div",{className:"flex justify-between items-start w-full",children:[r.jsxs("div",{className:"space-y-1 overflow-hidden max-w-[60%]",children:[r.jsx("div",{className:"font-medium truncate",children:e.description}),r.jsxs("div",{className:"flex gap-1 text-xs text-muted-foreground flex-wrap",children:[r.jsx("span",{className:"truncate",children:T(new Date(e.date),"MMM dd")}),r.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),r.jsx("span",{className:"capitalize truncate",children:e.category})]})]}),r.jsxs("div",{className:"text-right font-semibold min-w-[80px] flex-shrink-0",children:[o(Number(e.amount),l),s&&r.jsxs("div",{className:"text-xs text-muted-foreground",children:["Budget: ",o(a,l)]})]})]})})},e.id)}))}):r.jsxs(ue,{children:[r.jsx(xe,{children:r.jsxs(he,{children:[r.jsx(ge,{children:"Date"}),r.jsx(ge,{children:"Category"}),r.jsx(ge,{children:"Description"}),r.jsx(ge,{children:"Amount"}),r.jsx(ge,{children:"Budget"})]})}),r.jsx(je,{children:c.map((e=>{const s=u(e),a=s?Number(s.amount):0;return r.jsxs(he,{children:[r.jsx(pe,{children:T(new Date(e.date),"MMM dd, yyyy")}),r.jsx(pe,{children:e.category}),r.jsx(pe,{children:e.description}),r.jsx(pe,{children:o(Number(e.amount),l)}),r.jsx(pe,{children:s?r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{children:o(a,l)}),r.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:s.period})]}):r.jsx("span",{className:"text-muted-foreground text-xs",children:"No budget"})})]},e.id)}))})]})})})]})}function qe({budgets:e}){const s=a(),{currencyCode:n}=t(),d=e.reduce(((e,s)=>{const a=T(Ne(s.created_at),"MMM yyyy");return e[a]||(e[a]={month:a}),e[a][s.category]=(e[a][s.category]||0)+s.amount,e}),{}),l=Object.values(d).sort(((e,s)=>new Date(e.month).getTime()-new Date(s.month).getTime()));if(0===e.length||Object.keys(d).length<=1)return r.jsxs("div",{className:"flex flex-col items-center justify-center h-[250px] md:h-[300px] py-8 px-4 text-center",children:[r.jsx("p",{className:"text-muted-foreground mb-2",children:"Not enough data for monthly comparison"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:0===e.length?"Add your first budget to see monthly comparisons":"Add budgets across different months to see comparisons"})]});const c=Object.keys(K).filter((e=>l.some((s=>s[e]>0)))),i=e=>l.reduce(((s,a)=>s+(a[e]||0)),0),m=c.sort(((e,s)=>i(s)-i(e))).slice(0,s?4:6);return r.jsxs(Y,{className:"overflow-hidden rounded-xl shadow-md border bg-card",children:[r.jsx(W,{children:r.jsx(Z,{children:"Monthly Budget Comparison"})}),r.jsxs(G,{className:"p-4",children:[r.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-1 mb-4 justify-center",children:m.map((e=>r.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium whitespace-nowrap",children:[r.jsx("span",{className:"block w-3 h-3 rounded-full mr-1",style:{backgroundColor:K[e]}}),r.jsx("span",{className:"truncate",children:e})]},e)))}),r.jsx("div",{className:L("w-full py-2 px-2 md:px-6 rounded-lg bg-[hsl(var(--muted)/0.5)] border border-border/50","backdrop-blur-sm h-[270px] md:h-[350px]"),children:r.jsx(ae,{width:"100%",height:"100%",children:r.jsxs(le,{layout:"horizontal",data:l,margin:{top:10,right:s?8:30,left:s?10:20,bottom:s?30:40},barCategoryGap:s?"20%":"30%",children:[r.jsx(ce,{strokeDasharray:"3 3",vertical:!1,opacity:.11}),r.jsx(ie,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:s?11:13,fill:"var(--muted-foreground)"},height:40}),r.jsx(oe,{axisLine:!1,tickLine:!1,tick:{fontSize:s?10:12,fill:"var(--muted-foreground)"},tickFormatter:e=>`${e}`,width:s?50:70}),r.jsx(de,{cursor:{fill:"var(--muted)",opacity:.25},content:({active:e,payload:s,label:a})=>{if(!e||!s||!s.length)return null;const t=s.filter((e=>Number(e.value)>0));return r.jsxs("div",{className:"rounded-lg border bg-background/95 p-2 shadow-md text-xs backdrop-blur-sm",children:[r.jsx("div",{className:"font-semibold mb-1",children:a}),t.map(((e,s)=>r.jsxs("div",{className:"flex items-center gap-1 my-0.5",children:[r.jsx("span",{className:"block w-2.5 h-2.5 rounded-full",style:{backgroundColor:e.color}}),r.jsxs("span",{children:[e.name,":"]}),r.jsx("span",{className:"ml-1 font-semibold",children:o(Number(e.value),n)})]},e.name)))]})}}),m.map((e=>r.jsx(me,{dataKey:e,fill:K[e],radius:[4,4,4,4],maxBarSize:s?20:30,className:"transition-all"},e)))]})})})]})]})}const Ie=({budgets:e,onEditBudget:s,activeTab:t,onTabChange:n})=>{const d=a(),[l,c]=P.useState(t);P.useEffect((()=>{t!==l&&c(t)}),[t,l]);const i=[{id:"overview",label:"Overview",icon:Ce},{id:"categories",label:"Categories",icon:we},{id:"transactions",label:"Transactions",icon:q},{id:"comparison",label:"Comparison",icon:I}];return r.jsx("div",{className:"w-full space-y-4 mt-4",children:r.jsx(v.div,{className:"w-full flex justify-center",initial:{opacity:0,y:-5},animate:{opacity:1,y:0},transition:{duration:.3},children:r.jsxs(X,{value:l,onValueChange:e=>{c(e),n(e)},className:"w-full max-w-2xl mx-auto",children:[r.jsx(J,{className:"bg-background border border-border/40 p-1 rounded-full w-full justify-center gap-1.5 relative",children:i.map((e=>r.jsxs(ee,{value:e.id,className:"flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition-all\n                          data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\n                          data-[state=active]:shadow-sm hover:bg-muted/50",children:[r.jsx(e.icon,{className:"w-4 h-4"}),r.jsx("span",{className:d?"hidden sm:inline":"inline",children:e.label})]},e.id)))}),r.jsxs("div",{className:"mt-4 px-2 tab-content-mobile",children:[r.jsx(se,{value:"overview",className:"mt-0 space-y-4",children:r.jsx(Te,{budgets:e})}),r.jsx(se,{value:"categories",className:"mt-0 space-y-4",children:r.jsx(Le,{budgets:e,onEditBudget:s})}),r.jsx(se,{value:"transactions",className:"mt-0 space-y-4",children:r.jsx(Pe,{budgets:e})}),r.jsx(se,{value:"comparison",className:"mt-0 space-y-4",children:r.jsx(qe,{budgets:e})})]})]})})})};const _e=()=>{const[e,n]=P.useState(!1),[d,l]=P.useState(null),[c,i]=P.useState("overview"),{toast:o}=D(),m=w();a();const{currencyCode:u}=t(),{selectedMonth:x,getCurrentMonthData:h,updateMonthData:g}=_(),j=T(x,"yyyy-MM"),p=h(),{budgets:y,isLoading:f,exportBudgetData:N,totalBudget:v,remainingBalance:C,usagePercentage:B,monthlyIncome:k}=function(){const{selectedMonth:e,getCurrentMonthData:a,isLoading:t,updateMonthData:r}=_(),{user:n}=s(),d=a(),l=T(e,"yyyy-MM"),c=P.useRef({totalBudget:0,totalSpent:0,remainingBalance:0,usagePercentage:0}),[i,o]=P.useState({totalBudget:d.totalBudget||0,totalSpent:d.monthlyExpenses||0,remainingBalance:d.remainingBudget||0,usagePercentage:d.budgetUsagePercentage||0,monthlyIncome:d.monthlyIncome||0}),m=P.useRef(null),{data:u,isLoading:x}=U({queryKey:["budgets",l,null==n?void 0:n.id],queryFn:async()=>{if(!n)return[];const{data:e,error:s}=await b.from("budgets").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(s)throw s;return e},enabled:!!n}),{data:h,isLoading:g}=U({queryKey:["monthly_income",null==n?void 0:n.id],queryFn:async()=>{var e;if(!n)return{monthlyIncome:0};const{data:s,error:a}=await b.from("budgets").select("monthly_income").eq("user_id",n.id).limit(1);if(a)throw a;return{monthlyIncome:(null==(e=null==s?void 0:s[0])?void 0:e.monthly_income)||0}},enabled:!!n}),{data:j,isLoading:p}=U({queryKey:["expenses",l,null==n?void 0:n.id],queryFn:async()=>{if(!n)return[];const s=S(e),a=ve(e),{data:t,error:r}=await b.from("expenses").select("*").eq("user_id",n.id).gte("date",s.toISOString().split("T")[0]).lte("date",a.toISOString().split("T")[0]);if(r)throw r;return t},enabled:!!n}),y=x||p||t||g;return P.useEffect((()=>{if(y||!u||!j||!h)return;const e=h.monthlyIncome||0,s=(null==u?void 0:u.reduce(((e,s)=>e+s.amount),0))||0,a=(null==j?void 0:j.reduce(((e,s)=>e+Number(s.amount)),0))||0,t=s-a,n=s>0?a/s*100:0;return Math.abs(s-c.current.totalBudget)>.01||Math.abs(a-c.current.totalSpent)>.01||Math.abs(t-c.current.remainingBalance)>.01||Math.abs(n-c.current.usagePercentage)>.01||e!==i.monthlyIncome?(c.current={totalBudget:s,totalSpent:a,remainingBalance:t,usagePercentage:n},m.current&&window.clearTimeout(m.current),m.current=window.setTimeout((()=>{o({totalBudget:s,totalSpent:a,remainingBalance:t,usagePercentage:n,monthlyIncome:e}),r(l,{totalBudget:s,remainingBudget:t,budgetUsagePercentage:n,monthlyIncome:e})}),200),()=>{m.current&&window.clearTimeout(m.current)}):void 0}),[u,j,h,d,l,r,y,i.monthlyIncome]),{budgets:u,expenses:j,isLoading:y,exportBudgetData:()=>{if(!u)return;const s=[["Category","Amount","Period","Carry Forward","Created At"].join(","),...u.map((e=>[e.category,e.amount,e.period,e.carry_forward,T(new Date(e.created_at),"yyyy-MM-dd")].join(",")))].join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(a),t.download=`budget_data_${T(e,"yyyy-MM")}.csv`,t.click()},...i}}();P.useEffect((()=>{p.activeTab&&i(p.activeTab)}),[p.activeTab]),P.useEffect((()=>{f||g(j,{totalBudget:v,remainingBudget:C,budgetUsagePercentage:B,monthlyIncome:k})}),[v,C,B,k,j,g,f]);return f?r.jsx("div",{className:"p-4 flex justify-center min-h-[200px]",children:r.jsx("div",{className:"animate-pulse text-center",children:r.jsx("p",{className:"text-muted-foreground",children:"Loading your budget data..."})})}):r.jsxs("div",{className:"overflow-guard space-y-3 pb-20 md:pb-8 min-h-[100dvh] w-full overflow-x-hidden budget-container",children:[r.jsx("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm z-10 px-3 py-2",children:r.jsx(Me,{onAddBudget:()=>{l(null),n(!0)},onExport:N})}),r.jsx("div",{className:"px-3",children:r.jsx(Se,{totalBudget:v,remainingBalance:C,usagePercentage:B,monthlyIncome:k,isLoading:f})}),r.jsx("div",{className:"w-full min-h-[350px] budget-content my-[14px]",children:r.jsx(Ie,{budgets:y||[],onEditBudget:e=>{l(e),n(!0)},activeTab:c,onTabChange:e=>{i(e),g(j,{activeTab:e})}})}),r.jsx(ke,{open:e,onOpenChange:n,budget:d,onSuccess:()=>{n(!1),l(null),m.invalidateQueries({queryKey:["budgets"]}),o({title:"Success",description:`Budget ${d?"updated":"created"} successfully.`})},monthlyIncome:k,totalBudget:v})]})};export{_e as default};

import{c as e,u as s,a as t,b as a,f as n,r as i,s as r,d as l,j as o,e as c,I as d,B as m,t as x,g as h,h as u,W as p,i as y,m as f,D as j,k as g,l as v,n as N,o as w,S as b,p as E}from"./index-BKzwkbhU.js";import{u as k,c as C,p as M,C as S}from"./chartUtils-DiUYslSS.js";import{u as T,S as A,U as I,C as L,R as _,A as R}from"./AddExpenseSheet-A6kJh_go.js";import{e as D}from"./endOfMonth-DamK16rX.js";import{S as F}from"./skeleton-CF78e7qN.js";import{T as q,a as U,b as O,c as B,D as $,C as P}from"./tooltip-CZQ4xVpP.js";import{C as z,a as K,b as H,c as W}from"./card-d84NS_n5.js";import{P as G}from"./plus-BP6d835L.js";import{T as Q,a as Y,b as V,c as X,d as Z,e as J}from"./table-BAksRuoR.js";import{u as ee}from"./use-toast-C_SwDZk4.js";import{E as se,P as te}from"./pencil-1wjTYd5V.js";import{T as ae}from"./trash-2-CDOPMnMG.js";import{R as ne,P as ie,a as re,C as le,T as oe,B as ce,b as de,X as me,Y as xe,c as he}from"./PieChart-Bu6X0L8j.js";import{L as ue,a as pe,C as ye,u as fe}from"./useAnalyticsInsights-B-P6ea8t.js";import{C as je}from"./chart-pie-nMKg2ABX.js";import"./popover-DU_c79qr.js";import"./differenceInCalendarMonths-CClJslyN.js";import"./isSameMonth-CIK_ED-F.js";import"./loader-circle-C-HlKtqs.js";import"./refresh-cw-g0nJKCu_.js";import"./arrow-right-AykwIgfE.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=e("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]),ve=e("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),Ne=e("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),we=e("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function be(){return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"h-14",children:[o.jsx(F,{className:"h-8 w-1/3"}),o.jsx(F,{className:"h-4 w-1/2 mt-2"})]}),o.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map((e=>o.jsx(F,{className:"h-32 rounded-xl"},e)))}),o.jsx(F,{className:"h-36 rounded-xl"}),o.jsx(F,{className:"h-64 rounded-xl"})]})}const Ee=({isNewUser:e})=>{const{user:t}=s(),{selectedMonth:l}=a(),[c,d]=i.useState(""),m=l.getMonth()===(new Date).getMonth()&&l.getFullYear()===(new Date).getFullYear();return i.useEffect((()=>{(async()=>{var e;if(t){const{data:s,error:a}=await r.from("profiles").select("full_name").eq("id",t.id).single();d(!a&&s?s.full_name||"":(null==(e=t.user_metadata)?void 0:e.full_name)||"there")}})()}),[t]),o.jsxs("header",{className:"space-y-1",children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground",children:e?`Welcome, ${c||"there"}!`:m?"Dashboard":`${n(l,"MMMM yyyy")}`}),o.jsx("p",{className:"text-muted-foreground text-sm",children:e?"Let's start tracking your expenses. Add your first expense to get started!":m?"Here's an overview of your expenses":`Viewing your financial data for ${n(l,"MMMM yyyy")}`})]})};function ke({children:e,content:s,open:t,defaultOpen:a}){return o.jsx(q,{children:o.jsxs(U,{open:t,defaultOpen:a,children:[o.jsx(O,{asChild:!0,children:e}),o.jsx(B,{children:o.jsx("p",{children:s})})]})})}const Ce=({title:e,value:s,icon:t,subtext:a,children:n,className:i=""})=>{const r=c();return o.jsxs(z,{className:`transition-all duration-300 hover:shadow-md relative ${i}`,children:[o.jsx(K,{className:"flex flex-row items-center justify-between space-y-0 pb-2 "+(r?"p-3":""),children:o.jsx(H,{className:(r?"text-xs":"text-sm")+" font-medium",children:e})}),o.jsxs(W,{className:r?"p-3 pt-0":"",children:[o.jsx("div",{className:(r?"text-lg":"text-2xl")+" font-bold",children:s}),a&&o.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a}),n]})]})},Me=({value:e,inverse:s=!1})=>{if(Math.abs(e)<.1)return o.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"No change from last month"});const t=s?e<0:e>0,a=t?ve:ge,n=t?"text-expense-high":"text-expense-low";return o.jsxs("div",{className:`flex items-center ${n} text-xs mt-1`,children:[o.jsx(a,{className:"h-3 w-3 mr-1"}),Math.abs(e).toFixed(1),"% from last month"]})},Se=({monthlyIncome:e,setMonthlyIncome:t,percentageChange:a,formatCurrency:n,currencyCode:l})=>{const[c,h]=i.useState(!1),[u,p]=i.useState(e),{user:y}=s();return o.jsx(Ce,{title:"Monthly Income",value:c?"":n(e,l),icon:A,className:"cursor-pointer",children:c?o.jsxs("div",{className:"space-y-2",children:[o.jsx(d,{type:"number",value:u||0,onChange:e=>{const s=e.target.value.replace(/[^0-9]/g,"");(e=>{p(e)})(s?parseInt(s,10):0)},className:"h-8 text-base pr-2",min:0,autoFocus:!0}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(m,{size:"sm",className:"w-full h-7 text-xs",onClick:async()=>{try{if(!y)return;const{data:e,error:s}=await r.from("budgets").select("id, monthly_income").eq("user_id",y.id).limit(1);if(s)throw s;if(e&&e.length>0){const{error:e}=await r.from("budgets").update({monthly_income:u}).eq("user_id",y.id);if(e)throw e}else{const{error:e}=await r.from("budgets").insert({user_id:y.id,category:"General",amount:0,period:"monthly",monthly_income:u});if(e)throw e}const{error:a}=await r.from("profiles").update({monthly_income:u}).eq("id",y.id);t(u),h(!1),x.success("Monthly income updated successfully")}catch(e){x.error("Failed to save monthly income")}},children:"Save"}),o.jsx(m,{size:"sm",variant:"outline",className:"w-full h-7 text-xs",onClick:()=>{h(!1),p(e)},children:"Cancel"})]})]}):o.jsxs(o.Fragment,{children:[o.jsx(Me,{value:a}),o.jsx("div",{className:"absolute top-3 right-3 cursor-pointer hover:text-primary transition-colors",onClick:()=>h(!0),children:o.jsx(A,{size:16})})]})})},Te=({totalBalance:e,monthlyExpenses:t,monthlyIncome:l,setMonthlyIncome:d,savingsRate:m,formatPercentage:x,isNewUser:f,isLoading:j=!1})=>{const g=c(),{currencyCode:v}=u(),{selectedMonth:N}=a(),w=((e,t,l)=>{const{user:o}=s(),{selectedMonth:c}=a(),[d,m]=i.useState({expenses:0,income:0,savings:0});return i.useEffect((()=>{(async()=>{if(!o)return;const s=h(c,1),a=n(s,"yyyy-MM-01"),i=n(s,"yyyy-MM-dd");try{const{data:s}=await r.from("expenses").select("amount").eq("user_id",o.id).gte("date",a).lte("date",i),n=(null==s?void 0:s.reduce(((e,s)=>e+Number(s.amount)),0))||0,{data:c}=await r.from("profiles").select("monthly_income").eq("id",o.id).single(),d=(null==c?void 0:c.monthly_income)||t,x=d>0?(d-n)/d*100:0;let h=0,u=0,p=0;n>0&&(h=(e-n)/n*100),d>0&&(u=(t-d)/d*100),(x>0||l>0)&&(p=l-x),m({expenses:h,income:u,savings:p})}catch(d){}})()}),[o,c,e,t,l]),d})(t,l,m);if(j)return o.jsx("div",{className:"grid gap-4 "+(g?"grid-cols-2":"md:grid-cols-2 lg:grid-cols-4"),children:[1,2,3,4].map((e=>o.jsx(F,{className:"h-[100px]"},e)))});const b=new Intl.DateTimeFormat("en-US",{month:"long"}).format(N);return o.jsxs("div",{className:"grid gap-4 "+(g?"grid-cols-2":"md:grid-cols-2 lg:grid-cols-4"),children:[o.jsx(ke,{content:"Track your remaining balance after expenses",defaultOpen:f,children:o.jsx(Ce,{title:"Total Balance",value:y(e,v),icon:p,subtext:f?"Add expenses to see your balance":`${b} balance`})}),o.jsx(Ce,{title:"Monthly Expenses",value:y(t,v),icon:$,children:o.jsx(Me,{value:w.expenses,inverse:!0})}),o.jsx(Se,{monthlyIncome:l,setMonthlyIncome:d,percentageChange:w.income,formatCurrency:y,currencyCode:v}),o.jsx(Ce,{title:"Savings Rate",value:x(m),icon:ve,children:o.jsx(Me,{value:w.savings})})]})},Ae=({isNewUser:e,expenseToEdit:s,showAddExpense:t,setExpenseToEdit:a,setShowAddExpense:n,onAddExpense:r})=>{c();const{currencyCode:l}=u(),[d,x]=i.useState("manual"),[h,p]=i.useState(null),y=i.useRef(null),j=i.useRef(null),[g,v]=i.useState(null),N=e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];t&&(p(t),"manual"!==d&&n(!0),e.target.value="")},w=e=>{v(e),x(e),setTimeout((()=>{v(null),"manual"===e?n(!0):"upload"===e&&y.current?y.current.click():"camera"===e&&j.current&&j.current.click()}),300)},b={initial:{scale:1},active:{scale:.95,transition:{duration:.2}},hover:{scale:1.03,transition:{duration:.2}}};return o.jsxs("div",{className:"mt-4",children:[o.jsx(ke,{content:"Add an expense in different ways",defaultOpen:e,children:o.jsxs(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"bg-card rounded-xl border shadow-sm p-3 my-0 py-[19px]",children:[o.jsxs("h3",{className:"text-base font-medium mb-2 flex items-center my-px py-0",children:[o.jsx(G,{className:"h-4 w-4 text-primary mr-1.5"}),"Add New Expense"]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.jsx(f.div,{variants:b,initial:"initial",animate:"manual"===g?"active":"initial",whileHover:"hover",whileTap:"active",children:o.jsxs(m,{variant:"outline",onClick:()=>w("manual"),className:"h-16 w-full flex flex-col items-center justify-center border-dashed space-y-0.5 hover:bg-accent/30 transition-all my-0 rounded-lg font-normal py-[35px]",children:[o.jsx(G,{className:"h-4 w-4 text-primary"}),o.jsx("span",{className:"text-xs font-medium",children:"Manual"}),o.jsx("span",{className:"text-[10px] text-muted-foreground leading-tight",children:"Enter details"})]})}),o.jsx(f.div,{variants:b,initial:"initial",animate:"upload"===g?"active":"initial",whileHover:"hover",whileTap:"active",children:o.jsxs(m,{variant:"outline",onClick:()=>w("upload"),className:"h-16 w-full flex flex-col items-center justify-center rounded-lg border-dashed space-y-0.5 hover:bg-accent/30 transition-all py-[35px]",children:[o.jsx(I,{className:"h-4 w-4 text-primary"}),o.jsx("span",{className:"text-xs font-medium",children:"Upload"}),o.jsx("span",{className:"text-[10px] text-muted-foreground leading-tight",children:"Photo receipt"})]})}),o.jsx(f.div,{variants:b,initial:"initial",animate:"camera"===g?"active":"initial",whileHover:"hover",whileTap:"active",children:o.jsxs(m,{variant:"outline",onClick:()=>w("camera"),className:"h-16 w-full flex flex-col items-center justify-center rounded-lg border-dashed space-y-0.5 hover:bg-accent/30 transition-all py-[35px]",children:[o.jsx(L,{className:"h-4 w-4 text-primary"}),o.jsx("span",{className:"text-xs font-medium",children:"Camera"}),o.jsx("span",{className:"text-[10px] text-muted-foreground leading-tight",children:"Take photo"})]})})]})]})}),o.jsx(_,{onChange:N,inputRef:y,id:"receipt-upload-button",useCamera:!1}),o.jsx(_,{onChange:N,inputRef:j,id:"camera-capture-button",useCamera:!0}),o.jsx(R,{onAddExpense:r,expenseToEdit:s,onClose:()=>{a(void 0),n(!1),p(null),y.current&&(y.current.value=""),j.current&&(j.current.value="")},open:t||void 0!==s,onOpenChange:n,initialCaptureMode:d,initialFile:h})]})};function Ie({onAction:e,title:s,description:t}){return o.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[o.jsx("div",{className:"rounded-full bg-muted p-3 mb-4",children:o.jsx(G,{className:"h-6 w-6 text-muted-foreground"})}),o.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),o.jsx("p",{className:"text-muted-foreground mb-4 max-w-sm",children:t}),o.jsx(m,{onClick:e,children:"Add Your First Expense"})]})}const Le=[{id:"sample-1",description:"Groceries",amount:120.5,category:"Food",date:(new Date).toISOString().split("T")[0]},{id:"sample-2",description:"Internet Bill",amount:65,category:"Utilities",date:(new Date).toISOString().split("T")[0]},{id:"sample-3",description:"Movie Night",amount:30,category:"Entertainment",date:(new Date).toISOString().split("T")[0]}];function _e({onApply:e}){const[s,t]=i.useState(!1);return o.jsx(m,{variant:"outline",onClick:()=>{t(!0),setTimeout((()=>{e(Le),t(!1)}),500)},disabled:s,className:"w-full mt-2",children:"Try Sample Data"})}const Re=({expenses:e,isNewUser:a,isLoading:i,setExpenseToEdit:l,setShowAddExpense:d})=>{const{user:x}=s(),{toast:h}=ee(),p=t();c();const{currencyCode:f}=u();return o.jsxs(z,{children:[o.jsx(K,{children:o.jsx(H,{children:"Recent Expenses"})}),o.jsx(W,{children:i?o.jsx("div",{className:"flex justify-center p-6",children:o.jsx("p",{className:"text-muted-foreground",children:"Loading expenses..."})}):a?o.jsxs("div",{className:"space-y-4",children:[o.jsx(Ie,{title:"No expenses yet",description:"Start tracking your spending by adding your first expense.",onAction:()=>d(!0)}),o.jsx(_e,{onApply:async e=>{if(x)try{const s=e.map((e=>({user_id:x.id,amount:e.amount,description:e.description,date:e.date,category:e.category}))),{error:t}=await r.from("expenses").insert(s);if(t)throw t;await p.invalidateQueries({queryKey:["expenses"]}),h({title:"Sample Data Added",description:"Sample expenses have been added successfully."})}catch(s){h({title:"Error",description:"Failed to add sample data. Please try again.",variant:"destructive"})}}})]}):o.jsx("div",{className:"-mx-2 sm:mx-0",children:o.jsxs(Q,{children:[o.jsx(Y,{children:o.jsxs(V,{children:[o.jsx(X,{className:"w-[100px]",children:"Date"}),o.jsx(X,{children:"Name"}),o.jsx(X,{className:"text-right w-[90px]",children:"Amount"}),o.jsx(X,{className:"text-right w-[60px]",children:"Actions"})]})}),o.jsx(Z,{children:e.slice(0,5).map((e=>o.jsxs(V,{children:[o.jsx(J,{children:n(new Date(e.date),"MMM dd, yyyy")}),o.jsx(J,{children:o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-medium truncate",children:e.description}),o.jsx("span",{className:"text-xs text-muted-foreground truncate",children:e.category})]})}),o.jsx(J,{className:"text-right",children:y(e.amount,f)}),o.jsx(J,{className:"text-right p-0 pr-2 md:p-4",children:o.jsxs(j,{children:[o.jsx(g,{asChild:!0,children:o.jsxs(m,{variant:"ghost",size:"icon-sm",className:"h-8 w-8 ml-auto",children:[o.jsx(se,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Open menu"})]})}),o.jsxs(v,{align:"end",className:"w-[160px]",children:[o.jsxs(N,{onClick:()=>{l(e),d(!0)},children:[o.jsx(te,{className:"mr-2 h-4 w-4"}),o.jsx("span",{children:"Edit"})]}),o.jsxs(N,{onClick:()=>(async e=>{if(x)try{const{error:s}=await r.from("expenses").delete().eq("id",e);if(s)throw s;await p.invalidateQueries({queryKey:["expenses"]}),h({title:"Expense Deleted",description:"Expense has been deleted successfully."})}catch(s){h({title:"Error",description:"Failed to delete the expense. Please try again.",variant:"destructive"})}})(e.id),className:"text-destructive",children:[o.jsx(ae,{className:"mr-2 h-4 w-4"}),o.jsx("span",{children:"Delete"})]})]})]})})]},e.id)))})]})})})]})},De=({expenses:e,hideCenter:s=!1,height:t="250px",minifiedMode:a=!1})=>{const n=c(),{currencyCode:i}=u(),r=C(e),l=e.reduce(((e,s)=>e+Number(s.amount)),0),d=a?n?25:35:n?60:80,m=a?n?45:55:n?80:110;return o.jsxs("div",{className:`relative w-full h-[${"number"==typeof t?`${t}px`:t}] chart-wrapper ${a?"my-0":"my-[-20px]"}`,children:[!s&&o.jsxs("div",{className:"chart-center-total",children:[o.jsx("div",{className:"chart-center-total-amount text-foreground",children:y(l,i)}),o.jsx("div",{className:"chart-center-total-label text-muted-foreground",children:"Total Expenses"})]}),o.jsx(ne,{width:"100%",height:"100%",children:o.jsxs(ie,{margin:{top:0,right:0,bottom:0,left:0},children:[o.jsx(re,{data:r,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:d,outerRadius:m,paddingAngle:0,cornerRadius:0,strokeWidth:0,labelLine:!1,label:!1,children:r.map(((e,s)=>o.jsx(le,{fill:e.color,stroke:"transparent"},`cell-${s}`)))}),o.jsx(oe,{content:({active:e,payload:s})=>{if(!e||!s||!s.length)return null;const t=s[0].payload;return o.jsxs(f.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"tooltip-card bg-popover text-popover-foreground",children:[o.jsx("div",{className:"text-sm font-medium mb-1",children:t.name}),o.jsx("div",{className:"text-sm py-1",children:y(t.value,i)}),o.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[t.percent.toFixed(1),"% of total"]})]})}})]})}),!a&&o.jsx("div",{className:"expense-chart-legend my--9\\\\n my-0",children:r.slice(0,n?4:6).map(((e,s)=>o.jsxs("div",{className:"expense-chart-legend-item bg-muted/20 text-foreground",children:[o.jsx("div",{className:"expense-chart-legend-dot",style:{backgroundColor:e.color}}),o.jsx("span",{children:e.name}),o.jsxs("span",{className:"font-medium ml-1",children:[e.percent.toFixed(0),"%"]})]},s)))})]})},Fe=({expenses:e})=>{const s=c(),{currencyCode:t}=u(),a=M(e),n=Object.keys(S).filter((e=>a.some((s=>s[e]>0)))),i=e=>a.reduce(((s,t)=>s+(t[e]||0)),0),r=n.sort(((e,s)=>i(s)-i(e))).slice(0,s?3:5);return o.jsx("div",{className:"w-full h-[250px] md:h-[300px]",children:o.jsx(ne,{width:"100%",height:"100%",children:o.jsxs(ce,{data:a,margin:s?{top:20,right:0,left:0,bottom:20}:{top:20,right:30,left:0,bottom:5},barCategoryGap:s?"15%":"30%",maxBarSize:s?24:40,children:[o.jsx(de,{strokeDasharray:"3 3",vertical:!1,opacity:.2}),o.jsx(me,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:s?10:12,fill:"var(--foreground)"},dy:8,interval:s?1:0,height:s?30:40}),o.jsx(xe,{tickFormatter:e=>s?e>=1e3?`${Math.floor(e/1e3)}k`:e.toString():y(e,t),axisLine:!1,tickLine:!1,tick:{fontSize:s?10:12,fill:"var(--foreground)"},width:s?30:60}),o.jsx(oe,{content:({active:e,payload:s,label:a})=>{if(!e||!s||!s.length)return null;const n=s.filter((e=>(void 0!==e.value?Number(e.value):0)>0)).slice(0,3);return o.jsxs(f.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"tooltip-card bg-popover text-popover-foreground",children:[o.jsx("div",{className:"text-sm font-medium mb-1",children:a}),o.jsx("div",{className:"space-y-1",children:n.map(((e,s)=>o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),o.jsx("span",{className:"text-xs truncate max-w-[90px]",children:e.name})]}),o.jsx("span",{className:"text-xs font-medium",children:y(Number(e.value),t)})]},s)))})]})}}),r.map((e=>o.jsx(he,{dataKey:e,fill:S[e],radius:[4,4,0,0],maxBarSize:s?24:40},e)))]})})})},qe=({expenses:e})=>{const s=c(),{currencyCode:t}=u(),a=M(e),n=Object.keys(S).filter((e=>a.some((s=>s[e]>0)))),i=e=>a.reduce(((s,t)=>s+(t[e]||0)),0),r=n.sort(((e,s)=>i(s)-i(e))).slice(0,s?3:5);return o.jsx(ne,{width:"100%",height:"100%",children:o.jsxs(ue,{data:a,margin:s?{top:20,right:0,left:0,bottom:20}:{top:20,right:30,left:0,bottom:5},children:[o.jsx(de,{strokeDasharray:"3 3",vertical:!1,opacity:.2}),o.jsx(me,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:s?10:12,fill:"var(--foreground)"},dy:8,interval:s?1:0,height:s?30:40}),o.jsx(xe,{tickFormatter:e=>s?e>=1e3?`${Math.floor(e/1e3)}k`:e.toString():y(e,t),axisLine:!1,tickLine:!1,tick:{fontSize:s?10:12,fill:"var(--foreground)"},width:s?30:60}),o.jsx(oe,{content:({active:e,payload:s,label:a})=>{if(!e||!s||!s.length)return null;const n=s.filter((e=>(void 0!==e.value?Number(e.value):0)>0)).slice(0,3);return o.jsxs(f.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"tooltip-card bg-popover text-popover-foreground",children:[o.jsx("div",{className:"text-sm font-medium mb-1",children:a}),o.jsx("div",{className:"space-y-1",children:n.map(((e,s)=>o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.stroke}}),o.jsx("span",{className:"text-xs truncate max-w-[90px]",children:e.name})]}),o.jsx("span",{className:"text-xs font-medium",children:y(Number(e.value),t)})]},s)))})]})}}),r.map((e=>o.jsx(pe,{type:"monotone",dataKey:e,stroke:S[e],strokeWidth:s?1.5:2,dot:{r:s?2:3,strokeWidth:s?1:2,fill:"var(--background)",stroke:S[e]},activeDot:{r:s?4:5,strokeWidth:2,fill:"var(--background)",stroke:S[e]}},e)))]})})},Ue=({expenses:e,isLoading:s,chartType:t,setChartType:a})=>{const n=c(),i=Object.entries(S).reduce(((e,[s,t])=>(e[s]={color:t},e)),{});return o.jsxs(z,{className:w("overflow-hidden shadow-sm border-border/50",n&&"w-full max-w-md mx-auto"),children:[o.jsx(K,{className:"pb-2",children:o.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between w-full gap-2",children:[o.jsx(H,{className:w("text-lg font-semibold",n&&"text-center w-full"),children:"Expense Analytics"}),o.jsx("div",{className:"flex items-center",children:o.jsxs("div",{className:"bg-background/5 backdrop-blur-sm rounded-lg p-1 flex gap-1",children:[o.jsx("button",{onClick:()=>a("pie"),className:w("p-1.5 rounded-md transition-all","pie"===t?"bg-background shadow-sm text-primary":"hover:bg-muted text-muted-foreground hover:text-primary"),"aria-label":"Pie chart",children:o.jsx(je,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>a("bar"),className:w("p-1.5 rounded-md transition-all","bar"===t?"bg-background shadow-sm text-primary":"hover:bg-muted text-muted-foreground hover:text-primary"),"aria-label":"Bar chart",children:o.jsx(P,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>a("line"),className:w("p-1.5 rounded-md transition-all","line"===t?"bg-background shadow-sm text-primary":"hover:bg-muted text-muted-foreground hover:text-primary"),"aria-label":"Line chart",children:o.jsx(Ne,{className:"h-4 w-4"})})]})})]})}),o.jsx(W,{className:w("pt-2 pb-4 mx-0",n&&"flex flex-col items-center justify-center"),children:s?o.jsx("div",{className:"flex justify-center items-center h-[350px]",children:o.jsx("p",{className:"text-muted-foreground",children:"Loading analytics..."})}):0===e.length?o.jsx("div",{className:"flex justify-center items-center h-[350px]",children:o.jsx("p",{className:"text-muted-foreground",children:"Add some expenses to see analytics"})}):o.jsx(b,{className:w("h-[350px] w-full",n&&"max-w-[350px]"),children:o.jsx("div",{className:"flex justify-center items-center w-full my-0 py-0",children:o.jsx(f.div,{className:w("w-full max-w-[500px] min-h-[320px]",n&&"max-w-[300px]"),initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:o.jsx(ye,{className:w("h-full w-full min-h-[320px]",n&&"max-w-[300px] mx-auto"),config:i,children:(()=>{switch(t){case"pie":return o.jsx(De,{expenses:e});case"bar":return o.jsx(Fe,{expenses:e});case"line":return o.jsx(qe,{expenses:e});default:return null}})()})},t)})})})]})};function Oe(){const{openChat:e,remainingDailyMessages:t,isMessageLimitReached:a}=E(),{user:n}=s(),[l,c]=i.useState("");i.useEffect((()=>{(async()=>{var e;if(n){const{data:s,error:t}=await r.from("profiles").select("full_name").eq("id",n.id).single();c(!t&&s?s.full_name||"":(null==(e=n.user_metadata)?void 0:e.full_name)||"")}})()}),[n]);return o.jsx(z,{className:"relative overflow-hidden bg-gradient-to-br from-primary/5 to-background border-border/50",children:o.jsxs(f.div,{className:"p-4 flex flex-col gap-3",whileHover:{scale:1.01},transition:{duration:.2},children:[o.jsx("div",{className:"flex justify-between items-start",children:o.jsxs("div",{className:"space-y-1",children:[o.jsx("h3",{className:"font-medium text-base",children:"Talk to Finny"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:n?a?"Message limit reached for today. Try again tomorrow!":l?`Hello ${l}! Get instant help with your expenses (${t} messages left)`:`Get instant help with your expenses and budgeting (${t} messages left)`:"Sign in to access personalized finance assistance"})]})}),o.jsx("div",{children:o.jsxs(m,{onClick:e,variant:"default",className:"w-full sm:w-auto rounded-full transition-all duration-300 hover:shadow-md",disabled:n&&a,children:[o.jsx(we,{className:"w-4 h-4 mr-2"}),n?a?"Limit Reached":"Chat Now":"Try Finny"]})})]})})}function Be({isNewUser:e,isLoading:s,totalBalance:t,monthlyExpenses:a,monthlyIncome:n,setMonthlyIncome:i,savingsRate:r,formatPercentage:l,expenses:c,isExpensesLoading:d,expenseToEdit:m,setExpenseToEdit:x,showAddExpense:h,setShowAddExpense:u,handleExpenseRefresh:p,chartType:y,setChartType:j}){const g={hidden:{opacity:0,y:15},show:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}}};return o.jsxs(f.div,{className:"space-y-5 touch-scroll-container no-scrollbar",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",children:[o.jsx(f.div,{variants:g,children:o.jsx(Ee,{isNewUser:e})}),o.jsx(f.div,{variants:g,children:o.jsx(Te,{totalBalance:t,monthlyExpenses:a,monthlyIncome:n,setMonthlyIncome:i,savingsRate:r,formatPercentage:l,isNewUser:e,isLoading:s})}),o.jsx(f.div,{variants:g,children:o.jsx(Ae,{isNewUser:e,expenseToEdit:m,showAddExpense:h,setExpenseToEdit:x,setShowAddExpense:u,onAddExpense:p})}),o.jsx(f.div,{variants:g,children:o.jsx(Oe,{})}),o.jsx(f.div,{variants:g,children:o.jsx(Re,{expenses:c,isNewUser:e,isLoading:d,setExpenseToEdit:x,setShowAddExpense:u})}),o.jsx(f.div,{variants:g,children:o.jsx(Ue,{expenses:c,isLoading:d,chartType:y,setChartType:j})})]})}const $e=()=>{const{isLoading:e}=a(),{expenses:c,isExpensesLoading:d,isLoading:m,isNewUser:x,monthlyIncome:h,monthlyExpenses:u,totalBalance:p,savingsRate:y,chartType:f,setChartType:j,expenseToEdit:g,setExpenseToEdit:v,showAddExpense:N,setShowAddExpense:w,handleExpenseRefresh:b,formatPercentage:E,setMonthlyIncome:C}=function(){const{user:e}=s(),o=t(),{selectedMonth:c,getCurrentMonthData:d,updateMonthData:m}=a(),{refreshTrigger:x}=T(),h=n(c,"yyyy-MM"),u=d(),[p,y]=i.useState(u.monthlyIncome||0),[f,j]=i.useState(),[g,v]=i.useState("pie"),[N,w]=i.useState(!1),{data:b,isLoading:E}=k({queryKey:["monthly_income",null==e?void 0:e.id],queryFn:async()=>{if(!e)return{monthlyIncome:0};try{const{data:s,error:t}=await r.from("budgets").select("monthly_income").eq("user_id",e.id).limit(1);if(t)throw t;if(s&&s.length>0&&s[0].monthly_income)return{monthlyIncome:s[0].monthly_income};const{data:a,error:n}=await r.from("profiles").select("monthly_income").eq("id",e.id).single();return n?{monthlyIncome:0}:{monthlyIncome:(null==a?void 0:a.monthly_income)||0}}catch(s){return{monthlyIncome:0}}},enabled:!!e});i.useEffect((()=>{b&&!E&&(y(b.monthlyIncome),m(h,{monthlyIncome:b.monthlyIncome}))}),[b,E,m,h]);const{data:C=[],isLoading:M}=k({queryKey:["expenses",n(c,"yyyy-MM"),x,null==e?void 0:e.id],queryFn:async()=>{if(!e)return[];const s=l(c),t=D(c),{data:a,error:n}=await r.from("expenses").select("*").eq("user_id",e.id).gte("date",s.toISOString().split("T")[0]).lte("date",t.toISOString().split("T")[0]).order("date",{ascending:!1});return n?[]:a.map((e=>({id:e.id,amount:Number(e.amount),description:e.description,date:e.date,category:e.category,paymentMethod:e.payment||void 0,notes:e.notes||void 0,isRecurring:e.is_recurring||!1,receiptUrl:e.receipt_url||void 0})))},enabled:!!e}),S=C.reduce(((e,s)=>e+s.amount),0),A=p-S,I=p>0?(p-S)/p*100:0;i.useEffect((()=>{m(h,{monthlyIncome:p,monthlyExpenses:S,totalBalance:A,savingsRate:I})}),[p,S,h,m]),i.useEffect((()=>{x>0&&o.invalidateQueries({queryKey:["expenses",n(c,"yyyy-MM")]})}),[x,o,c]);const L=0===C.length;return{expenses:C,isExpensesLoading:M,isLoading:M||E,isNewUser:L,monthlyIncome:p,monthlyExpenses:S,totalBalance:A,savingsRate:I,chartType:g,setChartType:v,expenseToEdit:f,setExpenseToEdit:j,showAddExpense:N,setShowAddExpense:w,handleExpenseRefresh:()=>{o.invalidateQueries({queryKey:["expenses",n(c,"yyyy-MM")]})},formatPercentage:e=>new Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0}).format(e/100),setMonthlyIncome:y}}();return fe(c),m||e?o.jsx(be,{}):o.jsx(Be,{isNewUser:x,isLoading:m,totalBalance:p,monthlyExpenses:u,monthlyIncome:h,setMonthlyIncome:C,savingsRate:y,formatPercentage:E,expenses:c,isExpensesLoading:d,expenseToEdit:g,setExpenseToEdit:v,showAddExpense:N,setShowAddExpense:w,handleExpenseRefresh:b,chartType:f,setChartType:j})};export{$e as default};

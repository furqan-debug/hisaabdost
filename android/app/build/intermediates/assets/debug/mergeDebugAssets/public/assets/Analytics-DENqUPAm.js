import{e,h as a,i as s,j as t,m as r,d as n,g as i,f as d,o as l,u as c,b as o,r as x,s as m}from"./index-BKzwkbhU.js";import{C as p,f as h,p as u,u as g}from"./chartUtils-DiUYslSS.js";import{A as f,a as y}from"./alert-CN8C4i7Y.js";import{S as j}from"./skeleton-CF78e7qN.js";import{C as b,L as v,a as N,T as k,b as w,u as M}from"./useAnalyticsInsights-B-P6ea8t.js";import{M as C,E as S}from"./ExpenseFilters-C2GvbOcH.js";import{T as A,a as L,b as D,c as F}from"./tabs-SXOt8X-a.js";import{C as O,a as T,b as K,d as z,c as E}from"./card-d84NS_n5.js";import{R as $,P as B,a as R,C as P,T as W,B as q,b as Y,X as I,Y as G,c as H,d as J}from"./PieChart-Bu6X0L8j.js";import{e as U}from"./endOfMonth-DamK16rX.js";import"./isSameMonth-CIK_ED-F.js";import"./popover-DU_c79qr.js";import"./differenceInCalendarMonths-CClJslyN.js";function V({insights:n}){const i=e(),{currencyCode:d}=a();if(0===n.length)return null;const l=n.map((e=>{const a=e.message.replace(/\$(\d+(\.\d+)?)/g,((e,a)=>s(parseFloat(a),d)));let t=e.recommendation;return t&&(t=t.replace(/\$(\d+(\.\d+)?)/g,((e,a)=>s(parseFloat(a),d)))),{...e,message:a,recommendation:t}}));return t.jsx(r.div,{className:"grid gap-2.5",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:l.map(((e,a)=>t.jsx(r.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.1*a,duration:.3},children:t.jsx(f,{variant:"warning"===e.type?"destructive":"default",className:"py-2.5 shadow-sm border "+("success"===e.type?"bg-[#f0fdf4]/60 border-[#86efac]/40 dark:bg-[#052e16]/60 dark:border-[#22c55e]/30":"warning"===e.type?"bg-[#fef2f2]/70 border-[#fecaca]/40 dark:bg-[#450a0a]/70 dark:border-[#ef4444]/30":"highlight"===e.type?"bg-[#f8fafc]/60 border-[#cbd5e1]/40 dark:bg-[#0f172a]/60 dark:border-[#475569]/30":"tip"===e.type?"bg-[#eff6ff]/60 border-[#bfdbfe]/40 dark:bg-[#172554]/60 dark:border-[#3b82f6]/30":"bg-[#f5f5f4]/60 border-[#d6d3d1]/40 dark:bg-[#1c1917]/60 dark:border-[#78716c]/30"),children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"mt-0.5 flex-shrink-0",children:e.icon}),t.jsxs("div",{className:"space-y-1 overflow-hidden",children:[t.jsx(y,{className:`font-medium text-${i?"xs":"sm"} leading-snug`,children:e.message}),e.recommendation&&t.jsxs(y,{className:"text-xs text-muted-foreground "+(i?"line-clamp-2":""),children:["ðŸ’¡ ",e.recommendation]})]})]})},a)},a)))})}function X(){return t.jsxs(r.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},className:"flex flex-col gap-2",children:[t.jsx("h1",{className:"text-2xl font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent",children:"Analytics"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Track your spending patterns and financial trends"})]})}function _({expenses:a}){const s=e(),n=Object.entries(a.reduce(((e,a)=>(e[a.category]=(e[a.category]||0)+Number(a.amount),e)),{})).sort((([,e],[,a])=>a-e)).map((([e,a])=>({name:e,value:a,color:p[e]||"#94A3B8",percent:0}))),i=n.reduce(((e,a)=>e+a.value),0);n.forEach((e=>{e.percent=i>0?e.value/i*100:0}));const d=n.length>0?Math.round(n[0].percent):0;return t.jsxs("div",{className:"relative w-full flex flex-col items-center pb-6 mx--3 px-[16px]",children:[t.jsxs("div",{className:"relative w-full h-[240px]",children:[t.jsx($,{width:"100%",height:"100%",children:t.jsxs(B,{children:[t.jsx(R,{data:n,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:s?60:80,outerRadius:s?85:110,paddingAngle:0,startAngle:90,endAngle:-270,strokeWidth:0,labelLine:!1,label:!1,children:n.map(((e,a)=>t.jsx(P,{fill:e.color,stroke:"transparent"},`cell-${a}`)))}),t.jsx(W,{animationDuration:200,content:({active:e,payload:a})=>{if(!e||!a||!a.length)return null;const s=a[0];return t.jsxs(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-lg border bg-background/95 p-3 shadow-md backdrop-blur-sm",children:[t.jsx("p",{className:"text-sm font-semibold",style:{color:s.payload.color},children:s.name}),t.jsx("p",{className:"text-sm font-bold",children:h(Number(s.value))}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.payload.percent.toFixed(1),"% of total"]})]})}})]})}),t.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center",children:[t.jsxs("div",{className:"text-2xl font-semibold text-white",children:[d,"%"]}),t.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:n.length>0?n[0].name:"No data"})]})]}),t.jsx("div",{className:"expense-chart-legend mt-6 w-full flex flex-wrap justify-center gap-1.5",children:n.slice(0,s?5:6).map(((e,a)=>t.jsxs("div",{className:"expense-chart-legend-item",children:[t.jsx("div",{className:"expense-chart-legend-dot",style:{backgroundColor:e.color}}),t.jsx("span",{className:"truncate max-w-[90px]",children:e.name}),t.jsxs("span",{className:"font-medium ml-1",children:[e.percent.toFixed(0),"%"]})]},a)))})]})}function Q({expenses:e,config:a}){return t.jsxs(O,{className:"border-0 shadow-sm bg-card/80 px-0 my-px",children:[t.jsxs(T,{className:"pb-2",children:[t.jsx(K,{className:"text-lg font-medium",children:"Category Breakdown"}),t.jsx(z,{children:"Your expenses by category"})]}),t.jsx(E,{className:"px-0 pb-8",children:t.jsx(b,{config:a,className:"pie-chart-container h-[350px]",children:t.jsx(_,{expenses:e})})})]})}function Z({expenses:n}){const i=e(),{currencyCode:d}=a(),l=u(n),c=Object.keys(p).filter((e=>l.some((a=>a[e]>0)))),o=e=>l.reduce(((a,s)=>a+(s[e]||0)),0),x=c.sort(((e,a)=>o(a)-o(e))).slice(0,i?3:5);return t.jsxs("div",{className:"w-full h-full trends-chart-wrapper",children:[t.jsx($,{width:"100%",height:"100%",children:t.jsxs(q,{data:l,margin:i?{top:10,right:10,left:-15,bottom:5}:{top:20,right:30,left:0,bottom:5},barCategoryGap:i?"20%":"30%",maxBarSize:i?28:40,children:[t.jsx(Y,{strokeDasharray:"3 3",vertical:!1,opacity:.2}),t.jsx(I,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:i?10:12,fill:"var(--foreground)"},dy:8,interval:i?"preserveStartEnd":0,height:25}),t.jsx(G,{tickFormatter:e=>i?e>=1e3?`${Math.floor(e/1e3)}k`:e.toString():s(e,d),axisLine:!1,tickLine:!1,tick:{fontSize:i?10:12,fill:"var(--foreground)"},width:i?35:60}),t.jsx(W,{content:({active:e,payload:a,label:n})=>{if(!e||!a||!a.length)return null;const l=a.filter((e=>(void 0!==e.value?Number(e.value):0)>0)).slice(0,i?3:5);return t.jsxs(r.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"tooltip-card bg-popover text-popover-foreground",children:[t.jsx("div",{className:"text-sm font-medium mb-1",children:n}),t.jsx("div",{className:"space-y-1",children:l.map(((e,a)=>t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-xs truncate max-w-[90px]",children:e.name})]}),t.jsx("span",{className:"text-xs font-medium",children:s(Number(e.value),d)})]},a)))})]})}}),x.map((e=>t.jsx(H,{dataKey:e,fill:p[e],radius:[4,4,0,0],maxBarSize:i?28:40,animationDuration:800},e)))]})}),t.jsx("div",{className:"chart-legend-row",children:x.slice(0,i?3:5).map((e=>t.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full",style:{background:(p[e]||"#eee")+"22"},children:[t.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:p[e]}}),t.jsx("span",{className:"truncate",children:e.length>(i?8:12)?e.slice(0,i?8:12)+"â€¦":e})]},e)))})]})}function ee({expenses:n}){const i=e(),{currencyCode:d}=a(),l=u(n),c=Object.keys(p).filter((e=>l.some((a=>a[e]>0)))),o=e=>l.reduce(((a,s)=>a+(s[e]||0)),0),x=c.sort(((e,a)=>o(a)-o(e))).slice(0,i?3:5),m=l.flatMap((e=>x.map((a=>e[a]||0)).filter((e=>e>0)))),h=m.length>0?m.reduce(((e,a)=>e+a),0)/m.length:0;return t.jsxs("div",{className:"w-full h-full mx-- px-[6px] my-0",children:[t.jsx($,{width:"100%",height:"100%",children:t.jsxs(v,{data:l,margin:i?{top:15,right:10,left:-15,bottom:5}:{top:20,right:30,left:0,bottom:5},children:[t.jsx(Y,{strokeDasharray:"3 3",vertical:!1,opacity:.1}),t.jsx(I,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:i?11:13,fill:"var(--foreground)"},dy:8,interval:i?1:0,height:25}),t.jsx(G,{tickFormatter:e=>i?e>=1e3?`${Math.floor(e/1e3)}k`:e.toString():s(e,d),axisLine:!1,tickLine:!1,tick:{fontSize:i?11:13,fill:"var(--foreground)"},width:i?30:60}),h>0&&t.jsx(J,{y:h,stroke:"#8884d8",strokeDasharray:"3 3",strokeOpacity:.4}),t.jsx(W,{content:({active:e,payload:a,label:n})=>{if(!e||!a||!a.length)return null;const l=a.filter((e=>Number(e.value)>0)).slice(0,i?3:5);return t.jsxs(r.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"rounded-lg border bg-background/95 px-3 py-2 shadow-md backdrop-blur-sm",children:[t.jsx("p",{className:"text-sm font-semibold mb-1",children:n}),t.jsx("div",{className:"space-y-1",children:l.map(((e,a)=>t.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:e.stroke}}),t.jsx("span",{className:"truncate max-w-[90px]",children:e.name})]}),t.jsx("span",{className:"font-medium",children:s(Number(e.value),d)})]},a)))})]})}}),x.map((e=>t.jsx(N,{type:"monotone",dataKey:e,stroke:p[e],strokeWidth:i?2:2.5,dot:{r:i?3:4,strokeWidth:i?1.5:2,fill:"var(--background)",stroke:p[e]},activeDot:{r:i?5:6,strokeWidth:2,fill:"var(--background)",stroke:p[e]},animationDuration:1e3,animationBegin:500,isAnimationActive:!0},e)))]})}),t.jsx("div",{className:"chart-legend-row",children:x.map((e=>t.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full",style:{background:(p[e]||"#eee")+"22"},children:[t.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:p[e]}}),t.jsx("span",{className:"truncate",children:e.length>12?e.slice(0,12)+"â€¦":e})]},e)))})]})}function ae({expenses:e,config:a}){return t.jsxs(t.Fragment,{children:[t.jsxs(O,{className:"border-0 shadow-sm bg-card/80 trends-card py-[8px]",children:[t.jsxs(T,{className:"pb-2",children:[t.jsx(K,{className:"text-lg font-medium text-center",children:"Monthly Trends"}),t.jsx(z,{className:"text-center",children:"Your spending patterns over time"})]}),t.jsx(E,{className:"pt-0 pb-2 trends-chart-container my-[6px]",children:t.jsx("div",{className:"h-[220px] mx--4 my-[6px] py-[26px]",children:t.jsx(b,{config:a,children:t.jsx(Z,{expenses:e})})})})]}),t.jsxs(O,{className:"border-0 shadow-sm bg-card/80 trends-card",children:[t.jsxs(T,{className:"pb-2",children:[t.jsx(K,{className:"text-lg font-medium text-center",children:"Category Trends"}),t.jsx(z,{className:"text-center",children:"How your spending evolves by category"})]}),t.jsx(E,{className:"pt-0 pb-2 trends-chart-container py-[11px] my-[40px]",children:t.jsx("div",{className:"h-[220px] my-[8px] py-[31px]",children:t.jsx(b,{config:a,children:t.jsx(ee,{expenses:e})})})})]})]})}function se({currentMonthStart:e,lastMonthStart:a}){return t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 mb-6",children:[t.jsx(O,{className:"rounded-xl shadow-sm bg-[#f4fdf8]/60 border border-[#e0e5e9] dark:bg-[#051a10]/60 dark:border-[#1a2e25]",children:t.jsx(E,{className:"pt-4 pb-3 px-4",children:t.jsxs(r.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:[t.jsx("div",{className:"text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-100",children:d(e,"MMMM yyyy")}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Current Month"})]})})}),t.jsx(O,{className:"rounded-xl shadow-sm bg-[#f1f2ff]/60 border border-[#e1e5ee] dark:bg-[#0a0f24]/60 dark:border-[#1a1e32]",children:t.jsx(E,{className:"pt-4 pb-3 px-4",children:t.jsxs(r.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:[t.jsx("div",{className:"text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-100",children:d(a,"MMMM yyyy")}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Previous Month"})]})})})]})}function te({category:e,currentAmount:a,lastAmount:n,percentageChange:i,ratio:d,color:c,index:o,currencyCode:x}){const m=i>0,p=Math.abs(i)<.1,h={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{delay:.05*o,duration:.3,ease:"easeOut"}}};return t.jsxs(r.div,{variants:h,initial:"hidden",animate:"visible",className:"space-y-2.5",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:c}}),t.jsx("span",{className:"font-medium text-[15px]",children:e})]}),t.jsxs("div",{className:l("flex items-center gap-1 font-bold text-[14px]",m?"text-red-500 dark:text-red-400":p?"text-gray-500 dark:text-gray-400":"text-green-500 dark:text-green-400"),children:[m?t.jsx(k,{className:"w-3.5 h-3.5"}):p?t.jsx(C,{className:"w-3.5 h-3.5"}):t.jsx(w,{className:"w-3.5 h-3.5"}),t.jsxs("span",{children:[m?"+":"",Math.abs(i).toFixed(1),"%"]})]})]}),t.jsxs("div",{className:"flex justify-between items-center text-sm mb-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Current"}),t.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:s(a,x)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Previous"}),t.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:s(n,x)})]})]}),t.jsxs("div",{className:"h-3 bg-[#e9ecef] dark:bg-[#222] rounded-full overflow-hidden relative",children:[t.jsx("div",{className:l("h-full rounded-full transition-all duration-700 ease-out",m?"bg-red-400 dark:bg-red-500":p?"bg-gray-400 dark:bg-gray-500":"bg-green-400 dark:bg-green-500"),style:{width:`${d}%`,maxWidth:"100%"}}),t.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white/40 dark:bg-black/40",style:{left:"100%"}})]})]})}function re({expenses:e}){const{currencyCode:s}=a(),{currentMonthStart:d,lastMonthStart:l,comparisons:c}=function(e,a){const s=new Date,t=n(s),r=n(i(s,1)),d=U(r),l=e.filter((e=>new Date(e.date)>=t)),c=e.filter((e=>{const a=new Date(e.date);return a>=r&&a<=d})),o=(e,a)=>e.filter((e=>e.category===a)).reduce(((e,a)=>e+Number(a.amount)),0),x=Object.keys(a).map((e=>{const s=o(l,e),t=o(c,e);return{category:e,currentAmount:s,lastAmount:t,percentageChange:0===t?s>0?100:0:(s-t)/t*100,ratio:0===t?s>0?100:0:Math.min(200,Math.max(0,s/t*100)),color:a[e]}})).filter((e=>e.currentAmount>0||e.lastAmount>0)).sort(((e,a)=>Math.abs(a.percentageChange)-Math.abs(e.percentageChange)));return{currentMonthStart:t,lastMonthStart:r,comparisons:x}}(e,p);return t.jsxs("div",{className:"bg-card rounded-xl p-4 md:p-6 shadow-sm",children:[t.jsx(se,{currentMonthStart:d,lastMonthStart:l}),t.jsx("div",{className:"space-y-5",children:c.length>0?c.map(((e,a)=>t.jsx(te,{...e,index:a,currencyCode:s},e.category))):t.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:t.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:"Not enough data to compare this period."})})})]})}function ne({expenses:e}){return t.jsx(O,{className:"border-0 shadow-none bg-transparent",children:t.jsx(E,{className:"px-0 pt-0",children:t.jsx(re,{expenses:e})})})}function ie({filteredExpenses:e}){const a=Object.entries(p).reduce(((e,[a,s])=>(e[a]={color:s},e)),{});return t.jsx(O,{className:"border shadow-sm bg-card/50 backdrop-blur-sm overflow-hidden",children:t.jsx(E,{className:"p-0",children:t.jsxs(A,{defaultValue:"overview",className:"w-full",children:[t.jsxs(L,{className:"w-full justify-start rounded-none border-b bg-transparent p-0 mx-[5px] px-0 my-[4px]",children:[t.jsx(D,{value:"overview",className:"rounded-none border-b-2 border-transparent px-4 py-2.5 font-medium data-[state=active]:border-primary data-[state=active]:bg-transparent",children:"Overview"}),t.jsx(D,{value:"trends",className:"rounded-none border-b-2 border-transparent px-4 py-2.5 font-medium data-[state=active]:border-primary data-[state=active]:bg-transparent",children:"Trends"}),t.jsx(D,{value:"comparison",className:"rounded-none border-b-2 border-transparent px-4 py-2.5 font-medium data-[state=active]:border-primary data-[state=active]:bg-transparent",children:"Compare"})]}),t.jsxs("div",{className:"mt-4 space-y-4 px-3 md:px-4 pb-4",children:[t.jsx(F,{value:"overview",className:"mt-0 focus:outline-none focus:ring-0",children:t.jsx(Q,{expenses:e,config:a})}),t.jsx(F,{value:"trends",className:"mt-0 space-y-4 focus:outline-none focus:ring-0",children:t.jsx(ae,{expenses:e,config:a})}),t.jsx(F,{value:"comparison",className:"mt-0 focus:outline-none focus:ring-0",children:t.jsx(ne,{expenses:e})})]})]})})})}function de(){const{user:e}=c(),{selectedMonth:a}=o(),[s,n]=x.useState(""),[l,p]=x.useState("all"),[h,u]=x.useState({start:d(i(new Date,1),"yyyy-MM-dd"),end:d(new Date,"yyyy-MM-dd")}),{data:b,isLoading:v,error:N}=g({queryKey:["expenses",h,null==e?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:a,error:s}=await m.from("expenses").select("*").eq("user_id",e.id).gte("date",h.start).lte("date",h.end).order("date",{ascending:!1});if(s)throw s;return a||[]},enabled:!!e}),k=(null==b?void 0:b.filter((e=>{const a=e.description.toLowerCase().includes(s.toLowerCase())||e.category.toLowerCase().includes(s.toLowerCase()),t="all"===l||e.category===l;return a&&t})))||[],w=M(k),C={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4}}};return N?t.jsx(f,{variant:"destructive",children:t.jsx(y,{children:"Error loading expenses data. Please try again later."})}):v?t.jsxs("div",{className:"space-y-4",children:[t.jsx(j,{className:"h-8 w-[200px]"}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[t.jsx(j,{className:"h-[200px] rounded-xl"}),t.jsx(j,{className:"h-[200px] rounded-xl"}),t.jsx(j,{className:"h-[200px] rounded-xl"})]})]}):t.jsx("div",{className:"space-y-5 px-3 md:px-6 py-4 pb-20",children:t.jsxs(r.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-4",children:[t.jsx(r.div,{variants:C,children:t.jsx(X,{})}),t.jsx(r.div,{variants:C,children:t.jsx(S,{searchTerm:s,setSearchTerm:n,categoryFilter:l,setCategoryFilter:p,dateRange:h,setDateRange:u,selectedMonth:a,useCustomDateRange:!0,className:"mx-0 px-0"})}),t.jsx(r.div,{variants:C,children:t.jsx(V,{insights:w})}),t.jsx(r.div,{variants:C,children:t.jsx(ie,{filteredExpenses:k})})]})})}export{de as default};
